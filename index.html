<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>حصيف — النموذج الأولي</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: { DEFAULT: '#0f9f6e' }, /* أخضر أنيق */
            accent: { DEFAULT: '#c6a44b' },  /* ذهبي */
            ink: { DEFAULT: '#0f172a' },     /* نص غامق */
            stone: { DEFAULT: '#f8fafc' }    /* خلفية فاتحة */
          },
          boxShadow: {
            soft: '0 10px 20px rgba(2, 6, 23, 0.08)'
          },
          borderRadius: {
            xl2: '1rem'
          }
        }
      }
    }
  </script>
  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* تحسينات طفيفة */
    .glass { backdrop-filter: blur(8px); background: rgba(255,255,255,.7); }
    .scroll-slim::-webkit-scrollbar{width:8px;height:8px}
    .scroll-slim::-webkit-scrollbar-thumb{background:#e5e7eb;border-radius:8px}
    .rtl-input { direction: rtl; }
    /* جدول بسيط متجاوب */
    table { border-collapse: separate; border-spacing: 0 8px; }
    thead th { font-weight:600; color:#0f172a; }
    tbody tr { background:#fff; box-shadow: 0 1px 2px rgba(2,6,23,.05); }
    tbody td { border-top: 1px solid #f1f5f9; border-bottom:1px solid #f1f5f9; }
    tbody td:first-child { border-right:1px solid #f1f5f9; border-radius: .5rem 0 0 .5rem; }
    tbody td:last-child { border-left:1px solid #f1f5f9; border-radius: 0 .5rem .5rem 0; }
  </style>
</head>
<body class="bg-stone text-ink antialiased">

  <!-- Topbar -->
  <header class="sticky top-0 z-40 glass shadow-soft">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center gap-3">
      <div class="flex items-center gap-2">
        <div class="w-9 h-9 rounded-xl2 bg-primary/10 flex items-center justify-center">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M12 3l7 4v10l-7 4-7-4V7l7-4z" stroke="#0f9f6e" stroke-width="1.5"/>
            <path d="M9 12l3 2 3-2-3-2-3 2z" stroke="#0f9f6e" stroke-width="1.5"/>
          </svg>
        </div>
        <div class="leading-5">
          <div class="font-semibold">حصيف</div>
          <div class="text-xs text-slate-500">منصة تكامل تنموي مرتبطة برؤية 2030</div>
        </div>
      </div>

      <div class="flex-1"></div>

      <!-- Global Search -->
      <div class="relative w-full max-w-xl">
        <input id="globalSearch" type="search" class="rtl-input w-full rounded-xl2 border border-slate-200 bg-white/70 focus:outline-none focus:ring-2 focus:ring-primary/30 px-4 py-2 text-sm"
               placeholder="ابحث عن: مشروع، فعالية، وظيفة، منحة، مرفق..." />
        <button class="absolute left-2 top-1/2 -translate-y-1/2 text-slate-500" aria-label="Search">
          <i data-lucide="search" class="w-5 h-5"></i>
        </button>
      </div>

      <!-- Notifications / Profile -->
      <button id="btnNotifications" class="relative p-2 rounded-xl2 hover:bg-primary/10 transition" aria-label="Notifications">
        <i data-lucide="bell" class="w-5 h-5"></i>
        <span class="absolute -top-1 -right-1 bg-primary text-white text-[10px] leading-4 rounded-full px-1.5">3</span>
      </button>
      <div class="h-6 w-px bg-slate-200"></div>
      <button class="flex items-center gap-2 p-1 hover:bg-primary/10 rounded-xl2 transition" aria-label="Account">
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary/20 to-accent/20"></div>
        <div class="text-sm">حسابي</div>
        <i data-lucide="chevron-down" class="w-4 h-4"></i>
      </button>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 grid grid-cols-12 gap-6">

    <!-- Sidebar -->
    <aside class="col-span-12 md:col-span-3 lg:col-span-3">
      <div class="bg-white rounded-2xl shadow-soft p-4 space-y-4">

        <div>
          <div class="text-xs font-semibold text-slate-500 mb-2">القسم العام</div>
          <nav class="space-y-1" id="navMain">
            <button data-route="dashboard" class="navlink w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50">
              <span class="flex items-center gap-2"><i data-lucide="layout-dashboard" class="w-4 h-4"></i> الرئيسية</span>
              <span class="text-xs text-slate-400">Alt+1</span>
            </button>
            <button data-route="map" class="navlink w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50">
              <span class="flex items-center gap-2"><i data-lucide="map" class="w-4 h-4"></i> خريطة المناطق</span>
            </button>
            <button data-route="stories" class="navlink w-full flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-50">
              <span class="flex items-center gap-2"><i data-lucide="sparkles" class="w-4 h-4"></i> قصص الأثر</span>
            </button>
          </nav>
        </div>

        <div class="pt-2">
          <div class="text-xs font-semibold text-slate-500 mb-2">الحسابات</div>
          <div class="grid grid-cols-2 gap-2" id="accountsGrid">
            <!-- سيتم تعبئته ديناميكيًا -->
          </div>
        </div>

        <div class="pt-2">
          <div class="text-xs font-semibold text-slate-500 mb-2">المكوّنات</div>
          <div class="grid grid-cols-2 sm:grid-cols-3 gap-2" id="modulesGrid">
            <!-- يتم توليده -->
          </div>
        </div>

      </div>
      <div class="mt-4 bg-white rounded-2xl shadow-soft p-4">
        <div class="text-xs font-semibold text-slate-500 mb-2">إجراءات سريعة</div>
        <div class="grid grid-cols-2 gap-2">
          <button id="btnNewProject" class="px-3 py-2 rounded-lg text-sm bg-primary text-white hover:opacity-90">+ مشروع</button>
          <button id="btnNewEvent" class="px-3 py-2 rounded-lg text-sm bg-slate-900 text-white hover:opacity-90">+ فعالية</button>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="col-span-12 md:col-span-9 lg:col-span-9 space-y-6">

      <!-- KPI cards -->
      <section id="dashboard" class="view">
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
          <div class="bg-white rounded-2xl p-4 shadow-soft">
            <div class="text-xs text-slate-500">المشاريع النشطة</div>
            <div id="kpiProjects" class="text-2xl font-bold mt-1">—</div>
          </div>
          <div class="bg-white rounded-2xl p-4 shadow-soft">
            <div class="text-xs text-slate-500">قيمة التمويل (ر.س)</div>
            <div id="kpiFunding" class="text-2xl font-bold mt-1">—</div>
          </div>
          <div class="bg-white rounded-2xl p-4 shadow-soft">
            <div class="text-xs text-slate-500">الفعاليات القادمة</div>
            <div id="kpiEvents" class="text-2xl font-bold mt-1">—</div>
          </div>
          <div class="bg-white rounded-2xl p-4 shadow-soft">
            <div class="text-xs text-slate-500">فرص التطوع</div>
            <div id="kpiVol" class="text-2xl font-bold mt-1">—</div>
          </div>
        </div>

        <!-- Quick filters -->
        <div class="bg-white rounded-2xl p-4 shadow-soft mt-4">
          <div class="flex flex-wrap items-center gap-2">
            <select id="filterRegion" class="rtl-input border rounded-lg px-3 py-2 text-sm">
              <option value="">كل المناطق</option>
              <option>حائل</option>
              <option>الرياض</option>
              <option>مكة المكرمة</option>
            </select>
            <select id="filterSector" class="rtl-input border rounded-lg px-3 py-2 text-sm">
              <option value="">كل القطاعات</option>
              <option>حكومي</option>
              <option>خاص</option>
              <option>غير ربحي</option>
              <option>جامعات</option>
            </select>
            <select id="filterProgram" class="rtl-input border rounded-lg px-3 py-2 text-sm">
              <option value="">برامج الرؤية</option>
              <option>التحول الوطني</option>
              <option>جودة الحياة</option>
              <option>تنمية القدرات البشرية</option>
              <option>تطوير القطاع المالي</option>
              <option>الصناعة الوطنية والخدمات اللوجستية</option>
              <option>الإسكان</option>
            </select>
            <div class="flex-1"></div>
            <button id="btnResetFilters" class="text-sm px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200">إعادة الضبط</button>
          </div>
        </div>

        <!-- Projects Table -->
        <div class="bg-white rounded-2xl p-4 shadow-soft mt-4">
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">المشاريع</div>
            <div class="text-xs text-slate-500">نموذج عرض — للتجربة فقط</div>
          </div>
          <div class="overflow-auto scroll-slim">
            <table class="w-full text-sm">
              <thead>
                <tr class="text-right text-slate-500">
                  <th class="px-3 py-2">المشروع</th>
                  <th class="px-3 py-2">القطاع</th>
                  <th class="px-3 py-2">المنطقة</th>
                  <th class="px-3 py-2">البرنامج</th>
                  <th class="px-3 py-2">التمويل (ر.س)</th>
                  <th class="px-3 py-2">الحالة</th>
                  <th class="px-3 py-2"></th>
                </tr>
              </thead>
              <tbody id="projectsTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Map placeholder -->
      <section id="map" class="view hidden">
        <div class="bg-white rounded-2xl p-6 shadow-soft">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">خريطة المناطق (تجريبية)</h2>
            <button class="px-3 py-2 rounded-lg bg-slate-900 text-white text-sm">تحميل CSV</button>
          </div>
          <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-4 rounded-xl2 border">
              <div class="text-sm">حائل</div>
              <div class="text-xl font-bold mt-2"><span class="text-primary">12</span> مشروع</div>
            </div>
            <div class="p-4 rounded-xl2 border">
              <div class="text-sm">الرياض</div>
              <div class="text-xl font-bold mt-2"><span class="text-primary">18</span> مشروع</div>
            </div>
            <div class="p-4 rounded-xl2 border">
              <div class="text-sm">مكة</div>
              <div class="text-xl font-bold mt-2"><span class="text-primary">9</span> مشاريع</div>
            </div>
          </div>
          <div class="mt-6 h-64 rounded-xl2 bg-gradient-to-tr from-primary/10 to-accent/10 flex items-center justify-center text-slate-500">
            (مساحة خريطة تفاعلية لاحقًا — Leaflet)
          </div>
        </div>
      </section>

      <!-- Stories placeholder -->
      <section id="stories" class="view hidden">
        <div class="bg-white rounded-2xl p-6 shadow-soft">
          <h2 class="text-lg font-semibold mb-3">قصص أثر مختارة</h2>
          <div id="storiesWrap" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
      </section>

    </main>
  </div>

  <!-- Drawer: New Project -->
  <div id="drawerProject" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/30" data-close-drawer></div>
    <div class="absolute left-0 top-0 bottom-0 w-full max-w-xl bg-white shadow-2xl p-6 overflow-y-auto">
      <div class="flex items-center justify-between sticky top-0 bg-white pb-3">
        <h3 class="text-lg font-semibold">مشروع جديد</h3>
        <button class="p-2 hover:bg-slate-100 rounded-lg" data-close-drawer><i data-lucide="x" class="w-5 h-5"></i></button>
      </div>

      <form id="formProject" class="space-y-4 mt-3">
        <div>
          <label class="text-sm">اسم المشروع</label>
          <input required class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="name" />
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-sm">القطاع</label>
            <select class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="sector">
              <option>حكومي</option><option>خاص</option><option>غير ربحي</option><option>جامعات</option>
            </select>
          </div>
          <div>
            <label class="text-sm">المنطقة</label>
            <select class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="region">
              <option>حائل</option><option>الرياض</option><option>مكة المكرمة</option>
            </select>
          </div>
        </div>
        <div>
          <label class="text-sm">برنامج الرؤية (6/27/96)</label>
          <select class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="program">
            <option>جودة الحياة</option><option>التحول الوطني</option><option>تنمية القدرات البشرية</option>
            <option>تطوير القطاع المالي</option><option>الصناعة الوطنية والخدمات اللوجستية</option><option>الإسكان</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-sm">التمويل المطلوب (ر.س)</label>
            <input type="number" min="0" step="1000" class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="fund" />
          </div>
          <div>
            <label class="text-sm">الحالة</label>
            <select class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="status">
              <option>مسودة</option><option>قيد المراجعة</option><option>نشط</option>
            </select>
          </div>
        </div>
        <div>
          <label class="text-sm">وصف موجز</label>
          <textarea rows="3" class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="desc"></textarea>
        </div>

        <div class="pt-2 flex items-center gap-2">
          <button class="px-4 py-2 rounded-lg bg-primary text-white">حفظ</button>
          <button class="px-4 py-2 rounded-lg bg-slate-100" type="button" data-close-drawer>إلغاء</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Drawer: New Event -->
  <div id="drawerEvent" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/30" data-close-drawer></div>
    <div class="absolute left-0 top-0 bottom-0 w-full max-w-xl bg-white shadow-2xl p-6 overflow-y-auto">
      <div class="flex items-center justify-between sticky top-0 bg-white pb-3">
        <h3 class="text-lg font-semibold">فعالية جديدة</h3>
        <button class="p-2 hover:bg-slate-100 rounded-lg" data-close-drawer><i data-lucide="x" class="w-5 h-5"></i></button>
      </div>

      <form id="formEvent" class="space-y-4 mt-3">
        <div>
          <label class="text-sm">عنوان الفعالية</label>
          <input required class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="title" />
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-sm">التاريخ</label>
            <input type="date" class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="date" />
          </div>
          <div>
            <label class="text-sm">الموقع/المرفق</label>
            <input class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="venue" placeholder="قاعة، مسرح..." />
          </div>
        </div>
        <div>
          <label class="text-sm">الوصف</label>
          <textarea rows="3" class="rtl-input w-full mt-1 border rounded-lg px-3 py-2" name="desc"></textarea>
        </div>
        <div class="pt-2 flex items-center gap-2">
          <button class="px-4 py-2 rounded-lg bg-slate-900 text-white">حفظ</button>
          <button class="px-4 py-2 rounded-lg bg-slate-100" type="button" data-close-drawer>إلغاء</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-6 right-6 px-4 py-3 rounded-xl2 bg-emerald-600 text-white text-sm shadow-soft hidden">تم الحفظ</div>

  <script>
    // ---------------- Mock Data ----------------
    const accounts = [
      { key:'emirate',  name:'إمارة المنطقة', icon:'shield', color:'bg-primary/10' },
      { key:'gov',      name:'جهة حكومية',    icon:'building-2' },
      { key:'private',  name:'قطاع خاص',      icon:'briefcase' },
      { key:'nonprofit',name:'قطاع غير ربحي', icon:'heart' },
      { key:'uni',      name:'الجامعات',      icon:'graduation-cap' },
      { key:'funder',   name:'جهات مانحة',    icon:'wallet' },
      { key:'people',   name:'الأفراد',       icon:'users' },
      { key:'speakers', name:'مدربون/متحدثون',icon:'mic' },
      { key:'admin',    name:'حوكمة المنصة',  icon:'settings' },
    ];

    const modules = [
      { key:'projects', label:'مشاريع',   icon:'folder-kanban'},
      { key:'challenges',label:'تحديات',  icon:'puzzle'},
      { key:'events',   label:'فعاليات',   icon:'calendar'},
      { key:'facilities',label:'مرافق',   icon:'building'},
      { key:'jobs',     label:'وظائف',     icon:'badge-check'},
      { key:'training', label:'تدريب',     icon:'book-open'},
      { key:'volunteer',label:'تطوع',      icon:'hand-heart'},
      { key:'advisory', label:'استشارات',  icon:'life-buoy'},
      { key:'invest',   label:'استثمار',   icon:'trend-up'},
      { key:'donate',   label:'تبرعات',    icon:'donut'}, // icon placeholder
      { key:'funding',  label:'تمويل',     icon:'credit-card'},
      { key:'reports',  label:'تقارير',    icon:'bar-chart-3'},
    ];

    let projects = [
      { id:1, name:'مختبر ابتكار اجتماعي', sector:'جامعات', region:'حائل', program:'جودة الحياة', fund:250000, status:'نشط' },
      { id:2, name:'تمكين الأسر المنتجة',  sector:'غير ربحي', region:'الرياض', program:'التحول الوطني', fund:180000, status:'قيد المراجعة' },
      { id:3, name:'مركز قيادة تطوعي',    sector:'حكومي', region:'مكة المكرمة', program:'تنمية القدرات البشرية', fund:320000, status:'نشط' },
      { id:4, name:'منصة تعاون بحثي',      sector:'جامعات', region:'حائل', program:'تطوير القطاع المالي', fund:120000, status:'مسودة' },
      { id:5, name:'برنامج توظيف حديثي التخرج', sector:'خاص', region:'الرياض', program:'الصناعة الوطنية والخدمات اللوجستية', fund:210000, status:'نشط' },
    ];

    let events = [
      { id:1, title:'منتدى الإعلام التنموي', date:'2025-11-15', venue:'قاعة الغرفة التجارية', desc:'حضور قادة القطاعات' },
      { id:2, title:'لقاء الجامعات والجهات', date:'2025-12-02', venue:'جامعة حائل', desc:'ربط البحث بالتنفيذ' },
    ];

    // ---------------- Utilities ----------------
    const $ = (q, c=document) => c.querySelector(q);
    const $$ = (q, c=document) => Array.from(c.querySelectorAll(q));

    function toast(msg='تم الحفظ'){
      const el = $('#toast');
      el.textContent = msg;
      el.classList.remove('hidden');
      setTimeout(()=>el.classList.add('hidden'), 1800);
    }

    function switchView(id){
      $$('.view').forEach(v => v.classList.add('hidden'));
      $('#'+id)?.classList.remove('hidden');
      // active nav
      $$('#navMain .navlink').forEach(b=> b.classList.remove('bg-slate-100'));
      $(`#navMain .navlink[data-route="${id}"]`)?.classList.add('bg-slate-100');
      location.hash = id;
    }

    function renderAccounts(){
      const wrap = $('#accountsGrid');
      wrap.innerHTML = '';
      accounts.forEach(a=>{
        const btn = document.createElement('button');
        btn.className = 'flex items-center gap-2 px-3 py-2 rounded-lg border hover:shadow-soft transition text-sm';
        btn.innerHTML = `<i data-lucide="${a.icon}" class="w-4 h-4"></i><span>${a.name}</span>`;
        btn.onclick = ()=> toast(`تم اختيار: ${a.name}`);
        wrap.appendChild(btn);
      });
    }

    function renderModules(){
      const wrap = $('#modulesGrid');
      wrap.innerHTML = '';
      modules.forEach(m=>{
        const btn = document.createElement('button');
        btn.className = 'flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-slate-50 transition text-sm';
        btn.innerHTML = `<i data-lucide="${m.icon}" class="w-4 h-4"></i><span>${m.label}</span>`;
        btn.onclick = ()=>{
          if(m.key==='projects') switchView('dashboard');
          else if(m.key==='events') switchView('map'); // كمثال تنقّل
          else toast(`المكوّن: ${m.label} (نموذج)`);
        };
        wrap.appendChild(btn);
      });
    }

    function renderKPIs(){
      $('#kpiProjects').textContent = projects.length;
      const funding = projects.reduce((s,p)=> s + (Number(p.fund)||0), 0);
      $('#kpiFunding').textContent = funding.toLocaleString('ar-EG');
      $('#kpiEvents').textContent = events.length;
      $('#kpiVol').textContent = 7; // تجريبي
    }

    function renderProjectsTable(){
      const tb = $('#projectsTbody');
      const region = $('#filterRegion').value;
      const sector = $('#filterSector').value;
      const program = $('#filterProgram').value;
      const q = $('#globalSearch').value.trim();

      let list = projects.slice();

      if(region) list = list.filter(p=> p.region===region);
      if(sector) list = list.filter(p=> p.sector===sector);
      if(program) list = list.filter(p=> p.program===program);
      if(q) {
        const terms = q.split(/\s+/);
        list = list.filter(p => terms.every(t=>
          (p.name+p.sector+p.region+p.program+p.status).includes(t)
        ));
      }

      tb.innerHTML = '';
      list.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-3 py-3 font-medium">${p.name}</td>
          <td class="px-3 py-3 text-slate-600">${p.sector}</td>
          <td class="px-3 py-3 text-slate-600">${p.region}</td>
          <td class="px-3 py-3 text-slate-600">${p.program}</td>
          <td class="px-3 py-3 text-slate-600">${(Number(p.fund)||0).toLocaleString('ar-EG')}</td>
          <td class="px-3 py-3">
            <span class="px-2 py-1 rounded-full text-xs ${p.status==='نشط' ? 'bg-emerald-100 text-emerald-700' : p.status==='قيد المراجعة' ? 'bg-amber-100 text-amber-700' : 'bg-slate-100 text-slate-700'}">
              ${p.status}
            </span>
          </td>
          <td class="px-3 py-3">
            <div class="flex items-center gap-2">
              <button class="p-2 rounded-lg hover:bg-slate-100" aria-label="Edit"><i data-lucide="pen" class="w-4 h-4"></i></button>
              <button class="p-2 rounded-lg hover:bg-slate-100" aria-label="Delete"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
            </div>
          </td>
        `;
        tb.appendChild(tr);
      });
      lucide.createIcons();
    }

    function renderStories(){
      const wrap = $('#storiesWrap');
      wrap.innerHTML = '';
      const sample = [
        { title:'تمكين 120 مستفيدًا عبر برنامج تدريب متكامل', kpi:'+86% توظيف', region:'حائل' },
        { title:'تطوير مرافق جامعية لاحتضان مبادرات نوعية', kpi:'3 حاضنات', region:'الرياض' },
        { title:'تحسين جودة الحياة عبر فعاليات مجتمعية', kpi:'5 فعاليات', region:'مكة' },
        { title:'زيادة الشفافية في المنح والرعايات', kpi:'+1.2م ر.س', region:'الرياض' }
      ];
      sample.forEach(s=>{
        const card = document.createElement('div');
        card.className = 'p-4 rounded-2xl border bg-white';
        card.innerHTML = `
          <div class="text-sm text-slate-500">${s.region}</div>
          <div class="font-semibold mt-1">${s.title}</div>
          <div class="mt-3 text-primary text-sm">${s.kpi}</div>
        `;
        wrap.appendChild(card);
      });
    }

    // -------------- Drawers & Forms --------------
    function openDrawer(id){ $('#'+id).classList.remove('hidden'); }
    function closeDrawer(id){ $('#'+id).classList.add('hidden'); }

    // New Project
    $('#btnNewProject').addEventListener('click', ()=> openDrawer('drawerProject'));
    $('#btnNewEvent').addEventListener('click', ()=> openDrawer('drawerEvent'));
    $$('#drawerProject [data-close-drawer]').forEach(b=> b.onclick = ()=> closeDrawer('drawerProject'));
    $$('#drawerEvent [data-close-drawer]').forEach(b=> b.onclick = ()=> closeDrawer('drawerEvent'));

    $('#formProject').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const item = {
        id: Math.max(0,...projects.map(p=>p.id))+1,
        name: fd.get('name'),
        sector: fd.get('sector'),
        region: fd.get('region'),
        program: fd.get('program'),
        fund: Number(fd.get('fund')||0),
        status: fd.get('status'),
      };
      projects.unshift(item);
      closeDrawer('drawerProject');
      renderKPIs(); renderProjectsTable();
      e.target.reset();
      toast('تم حفظ المشروع');
    });

    $('#formEvent').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      events.unshift({
        id: Math.max(0,...events.map(x=>x.id))+1,
        title: fd.get('title'),
        date: fd.get('date'),
        venue: fd.get('venue'),
        desc: fd.get('desc')
      });
      closeDrawer('drawerEvent');
      renderKPIs();
      e.target.reset();
      toast('تم حفظ الفعالية');
    });

    // Filters + search
    $('#filterRegion').onchange = renderProjectsTable;
    $('#filterSector').onchange = renderProjectsTable;
    $('#filterProgram').onchange = renderProjectsTable;
    $('#btnResetFilters').onclick = ()=>{
      $('#filterRegion').value=''; $('#filterSector').value=''; $('#filterProgram').value='';
      $('#globalSearch').value=''; renderProjectsTable();
    };
    $('#globalSearch').addEventListener('input', ()=> renderProjectsTable());

    // Nav
    $$('#navMain .navlink').forEach(b => b.onclick = ()=> switchView(b.dataset.route));
    window.addEventListener('hashchange', ()=> switchView(location.hash.replace('#','') || 'dashboard'));

    // Keyboard shortcut Alt+1 → dashboard
    window.addEventListener('keydown', (e)=>{
      if(e.altKey && e.key==='1'){ switchView('dashboard'); }
    });

    // Init
    renderAccounts();
    renderModules();
    renderKPIs();
    renderProjectsTable();
    renderStories();
    switchView(location.hash.replace('#','') || 'dashboard');

    lucide.createIcons();
  </script>
</body>
</html>
